<?php
session_start();
if (!isset($_SESSION['admin'])) {
    header("Location: login.php");
    exit();
}

include("../database/config.php");

// Fetch events
$events_sql = "SELECT * FROM events ORDER BY created_at DESC";
$events_result = $conn->query($events_sql);

// Fetch reviews
$reviews_sql = "SELECT * FROM reviews ORDER BY created_at DESC";
$reviews_result = $conn->query($reviews_sql);

// Fetch registrations
$regs_sql = "SELECT r.id, r.student_name, r.email, r.phone, r.roll_no, r.college_name, r.created_at, e.name AS event_name
             FROM registrations r 
             JOIN events e ON r.event_id = e.id
             ORDER BY r.created_at DESC";
$regs_result = $conn->query($regs_sql);

$page = isset($_GET['page']) ? $_GET['page'] : 'events';
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - FestHub</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { margin:0; font-family:"Poppins",sans-serif; display:flex; flex-direction:column; background:#f4f4f4; }

    /* College Header */
    .college-header {
      background: #fff;
      border-bottom: 3px solid #3498db;
      text-align: center;
      padding: 15px 20px;
    }
    .college-header img {
      height: 80px;
      width: auto;
      vertical-align: middle;
      margin-right: 10px;
    }
    .college-header h1 {
      display: inline-block;
      font-size: 32px;
      font-weight: 700;
      color: #b22222;
      margin: 0;
      vertical-align: middle;
    }
    .college-header p {
      font-size: 16px;
      color: #333;
      margin: 5px 0 0;
    }
    .college-header .badges {
      margin-top: 8px;
    }
    .college-header .badge {
      display: inline-block;
      background: #3498db;
      color: #fff;
      font-size: 13px;
      padding: 6px 14px;
      border-radius: 20px;
      font-weight: 600;
      margin: 0 4px;
    }
    .college-header .badge.green { background: #2e7d32; }

    /* Layout */
    .main { display:flex; height:100vh; }

    /* Sidebar */
    .sidebar { 
      width: 250px; 
      background:#3498db; 
      padding:20px; 
      color:#fff; 
    }
    .sidebar h2 {
  font-size: 24px;
  margin-bottom: 10px;
  font-weight: 700;
  color: #ffffff;   /* force white */
  text-transform: uppercase;
  letter-spacing: 1px;
}

.sidebar h3 {
  margin-bottom: 25px;
  font-weight: 600;
  color: #f1f1f1;   /* slightly lighter but still visible */
  text-transform: uppercase;
}

    .sidebar a { 
      display:block; 
      padding:12px; 
      margin:10px 0; 
      text-decoration:none;
      background:#2980b9; 
      border-radius:8px; 
      color:#fff; 
      font-weight:500; 
      text-align:center;
    }
    .sidebar a:hover { background:#1f5f8c; }

    /* Content */
    .content { flex:1; padding:30px; background:#f9f9f9; overflow-y:auto; }
    h1 { font-size:24px; margin-bottom:10px; }
    h2 { margin-top:30px; color:#2980b9; }
    h3 { color:#2980b9; }

    /* Tables */
    table { 
      width:100%; 
      border-collapse: collapse; 
      margin-top:15px; 
      background:#fff;
      border-radius:10px; 
      overflow:hidden; 
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    th, td { padding:14px; text-align:center; }
    th { background:#3498db; color:#fff; }
    tr:nth-child(even) { background:#f2f6fb; }

    /* Images */
    img { width:70px; height:70px; object-fit:cover; border-radius:8px; }

    /* Actions */
    .actions a { 
      padding:6px 12px; 
      border-radius:6px; 
      font-size:14px; 
      text-decoration:none; 
      margin:0 4px; 
      display:inline-block;
    }
    .edit { background:#3498db; color:#fff; }
    .edit:hover { background:#2980b9; }
    .delete { background:#e74c3c; color:#fff; }
    .delete:hover { background:#c0392b; }

    /* Review Cards */
    .review-card { 
      background:#fff; 
      padding:15px; 
      margin:10px 0; 
      border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    .review-card strong { color:#3498db; }
    .rating { color:gold; }

    /* Add Button */
    .add-btn { 
      padding: 10px 16px; 
      background:#3498db; 
      color: #fff;
      border-radius: 8px; 
      text-decoration: none; 
      font-weight: bold; 
      transition: 0.3s; 
    }
    .add-btn:hover { background: #2980b9; }
  </style>
</head>
<body>

  <!-- College Header -->
  <div class="college-header">
    <img src="../assets/images/rvrlogo.jpeg" alt="RVR Logo">
    <h1>R.V.R. & J.C. COLLEGE OF ENGINEERING</h1>
    <p>(AUTONOMOUS) | EAPCET Code: RVJC<br>Affiliated to Acharya Nagarjuna University</p>
    <div class="badges">
      <div class="badge">NBA</div>
      <div class="badge green">NAAC A+</div>
    </div>
  </div>

  <div class="main">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>FEST HUB</h2>
      <h3>ADMIN PANEL</h3>
      <a href="dashboard.php?page=events">ðŸ“… Manage Events</a>
      <a href="dashboard.php?page=registrations">ðŸ“‹ View Registrations</a>
      <a href="dashboard.php?page=reviews">ðŸ’¬ View Reviews</a>
      <a href="index.php">ðŸšª Logout</a>
    </div>

    <!-- Content -->
    <div class="content">
      <h1>Welcome, <?php echo $_SESSION['admin']; ?> ðŸ‘‹</h1>
      <p>Here are the latest updates from your events and reviews.</p>

      <?php if ($page == "events") { ?>
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h2>ðŸ“… Ongoing Events</h2>
          <a href="addevent.php" class="add-btn">âž• Add Event</a>
        </div>
        <table>
          <tr>
            <th>Poster</th><th>Name</th><th>College Name</th><th>Category</th><th>Date</th>
            <th>Location</th><th>Participants</th><th>Price</th><th>Organizer</th><th>Actions</th>
          </tr>
          <?php if ($events_result && $events_result->num_rows > 0) {
            while($row = $events_result->fetch_assoc()) { ?>
            <tr>
              <td><?php if (!empty($row['poster'])) { ?><img src="../<?php echo $row['poster']; ?>" alt="Poster"><?php } else { echo "No Poster"; } ?></td>
              <td><?php echo htmlspecialchars($row['name']); ?></td>
               <td><?php echo htmlspecialchars($row['college_name']); ?></td>
              <td><?php echo htmlspecialchars($row['category']); ?></td>
              <td><?php echo htmlspecialchars($row['event_date']); ?></td>
              <td><?php echo htmlspecialchars($row['location']); ?></td>
              <td><?php echo htmlspecialchars($row['participants']); ?></td>
              <td><?php echo htmlspecialchars($row['price']); ?></td>
              <td><?php echo htmlspecialchars($row['organizer']); ?></td>
              <td class="actions">
                <a href="editevent.php?id=<?php echo $row['id']; ?>" class="edit">Edit</a>
                <a href="deleteevent.php?id=<?php echo $row['id']; ?>" class="delete" onclick="return confirm('Delete this event?')">Delete</a>
              </td>
            </tr>
          <?php } } else { ?>
            <tr><td colspan="9">No events available</td></tr>
          <?php } ?>
        </table>

      <?php } elseif ($page == "registrations") { ?>
        <h2>ðŸ“‹ Student Registrations</h2>
        <table>
          <tr>
            <th>ID</th><th>Student</th><th>Email</th><th>Phone</th>
            <th>Roll</th><th>College</th><th>Event</th><th>Registered At</th><th>Actions</th>
          </tr>
          <?php if ($regs_result && $regs_result->num_rows > 0) {
            while($reg = $regs_result->fetch_assoc()) { ?>
              <tr>
                <td><?php echo $reg['id']; ?></td>
                <td><?php echo htmlspecialchars($reg['student_name']); ?></td>
                <td><?php echo htmlspecialchars($reg['email']); ?></td>
                <td><?php echo htmlspecialchars($reg['phone']); ?></td>
                <td><?php echo htmlspecialchars($reg['roll_no']); ?></td>
                <td><?php echo htmlspecialchars($reg['college_name']); ?></td>
                <td><?php echo htmlspecialchars($reg['event_name']); ?></td>
                <td><?php echo $reg['created_at']; ?></td>
                <td class="actions">
                  <a href="deleteregistration.php?id=<?php echo $reg['id']; ?>" 
                     class="delete" 
                     onclick="return confirm('Are you sure you want to delete this registration?')">
                     Delete
                  </a>
                </td>
              </tr>
          <?php } } else { ?>
            <tr><td colspan="9">No registrations found</td></tr>
          <?php } ?>
        </table>

      <?php } elseif ($page == "reviews") { ?>
        <h2>ðŸ’¬ Event Reviews</h2>
        <?php if ($reviews_result && $reviews_result->num_rows > 0) {
          while($rev = $reviews_result->fetch_assoc()) { ?>
            <div class="review-card">
              <p><strong><?php echo htmlspecialchars($rev['name']); ?></strong> (<?php echo htmlspecialchars($rev['email']); ?>)</p>
              <p><?php echo htmlspecialchars($rev['message']); ?></p>
              <small><?php echo $rev['created_at']; ?></small>
            </div>
        <?php } } else { ?>
          <p>No reviews yet.</p>
        <?php } ?>
      <?php } ?>
    </div>
  </div>
</body>
</html>
